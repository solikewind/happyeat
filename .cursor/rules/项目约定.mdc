---
alwaysApply: true
---
# 项目约定

## 项目与技术栈
- **项目**：HappyEat，餐饮相关后端服务（餐桌、菜单、订单、工作台等）。
- **语言**：Go。
- **框架**：go-zero（zeromicro/go-zero），HTTP 使用 `rest`，代码生成使用 goctl。
- **配置**：YAML（`app/etc/*.yaml`、根目录 `etc/`）。
- **权限**：JWT（Auth）+ Casbin（RBAC）。
- **数据层**：使用 ent，**统一**放在 `dal/model/ent/`（见下）。

## 模块与目录
- **根模块**：`github.com/solikewind/happyeat`（见 `go.mod`）。
- **服务入口**：每个服务在 `app/` 下，如 `app/happyeatservice.go`；配置在 `app/etc/`。
- **API 定义**：`app/api/`（`base/`、`v1/`），`.api` 使用 go-zero api 语法。
- **内部包**：`app/internal/`（config、handler、logic、svc、types、constants）；**禁止**使用短路径 `happyeat/internal/...`。

## DAL / model：统一 ent + 按业务小块分 data 层
- **ent 统一**：`dal/model/ent/`
  - `schema/`：所有业务实体（Menu、MenuCategory、MenuSpec、Table、TableCategory，及后续 Order、工作台等）。
  - 生成代码与 schema 同级；一次 `go generate`，一个 Client。
- **data 层按业务小块分目录**（共用同一 `*ent.Client`）：
  - `dal/model/menu/menu.go`、`menutype.go`：菜单、菜单分类的 data 逻辑。
  - `dal/model/table/table.go`、`tabletype.go`：餐桌、餐桌分类的 data 逻辑。
  - `dal/model/order/order.go`：订单及订单明细的 data 逻辑（堂食关联餐桌，外带无桌台）。
  - 后续工作台等同理，在 `dal/model/<名>/` 下写 data 层，注入 `*ent.Client`。
- User/权限 若独立，可单独一模块（如 `dal/model/user`）或独立服务。

## 导入路径规则
- 正确：`github.com/solikewind/happyeat/app/internal/config`、`github.com/solikewind/happyeat/dal/model/menu`、`github.com/solikewind/happyeat/dal/model/table` 等。
- 错误：`happyeat/internal/...`（会报 no required module provides package）。

## 代码风格
- Handler：解析请求、调 Logic、写响应；业务在 `logic/`。
- Logic：使用 `*svc.ServiceContext`；新增 API 先改 `.api` 再用 goctl 生成。
- 函数内按业务步骤分块，逻辑块之间加空行。
